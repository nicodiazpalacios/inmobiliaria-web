<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Control - Staff</title>

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <style>
      body {
        font-family: "Work Sans", "Noto Sans", sans-serif;
        background-color: #f9fafb;
      }

      /* Layout principal: Contiene Sidebar y Main Content, FORZADO A SER HORIZONTAL */
      .layout-container {
        display: flex;
        flex-direction: row; /* CLAVE: Lado a lado */
        min-height: 100vh;
        flex-grow: 1;
      }

      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        padding: 2rem;
      }

      /* Tarjetas métricas */
      .metric-card {
        background-color: white;
        border-radius: 0.75rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        padding: 1.5rem;
        flex: 1;
      }

      /* Botones de estado (w-24 aplicado en el HTML para ancho fijo) */
      .status-active {
        background-color: #1193d4;
        color: white;
      }
      .status-paused {
        background-color: #e5e7eb;
        color: #111618;
      }

      /* Estilos de tabla base */
      table { border-collapse: collapse; width: 100%; }
      th, td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
      th { background-color: #f9fafb; font-weight: 600; }
      
      /* Estilo para títulos de sección */
      .section-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #111618;
        margin-top: 2rem;
        margin-bottom: 1rem;
      }

      /* Texto gris secundario */
      .text-secondary {
        color: #6b7280;
      }
    </style>
  </head>

  <body class="bg-[#f9fafb]">

    <div th:replace="header :: header"></div>

    <div class="layout-container">

      <div th:replace="sidebar :: sidebar-menu"></div>

      <div class="main-content">
        
        <div class="flex flex-col gap-2 mb-6">
          <h1 class="text-[28px] font-bold text-[#111618] leading-tight">Panel de control</h1>
          <p class="text-sm text-[#617c89]" th:text="|Bienvenida de nuevo, ${currentUser.name}|">Bienvenida de nuevo, Olivia Bennett</p>
        </div>

        <div class="flex flex-wrap gap-4 mb-8">
          <div class="metric-card">
            <p class="text-[#111618] text-base font-medium">Listados activos</p>
            <p class="text-[#111618] text-3xl font-bold mt-2" th:text="${metrics.activeListings}">3</p>
          </div>
          <div class="metric-card">
            <p class="text-[#111618] text-base font-medium">Contratos activos</p>
            <p class="text-[#111618] text-3xl font-bold mt-2" th:text="${metrics.activeContracts}">2</p>
          </div>
          <div class="metric-card">
            <p class="text-[#111618] text-base font-medium">Pagos pendientes</p>
            <p class="text-[#111618] text-3xl font-bold mt-2" th:text="${metrics.pendingPayments}">1</p>
          </div>
        </div>

        <h2 class="section-title">Actividad reciente</h2>
        <div class="bg-white rounded-xl shadow-sm p-4 mb-8">
          <div th:each="activity, stat : ${recentActivity}" class="flex items-start gap-3 border-b border-[#f3f4f6] py-3 last:border-none">
            <div class="text-[#111618] mt-1">•</div>
            <div>
              <p class="text-[#111618] text-base font-medium" th:text="${activity.description}">Nuevo contrato de alquiler creado para 123 Maple Street</p>
              <p class="text-secondary text-sm" th:text="${activity.timeAgo}">Hace 2 días</p>
            </div>
          </div>
          <div th:if="${#lists.isEmpty(recentActivity)}" class="text-center text-secondary py-4">
            No hay actividad reciente.
          </div>
        </div>

        <h2 class="section-title">Próximos vencimientos</h2>
        <div class="bg-white rounded-xl shadow-sm p-4 overflow-x-auto mb-8">
          <table>
            <thead>
              <tr>
                <th>Dirección</th>
                <th>Tipo</th>
                <th>Fecha de vencimiento</th>
                <th>Monto</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="due : ${upcomingDues}">
                <td th:text="${due.address}">123 Maple Street</td>
                <td th:text="${due.type}">Alquiler</td>
                <td th:text="${#temporals.format(due.dueDate, 'dd MMMM yyyy')}">15 de Julio de 2024</td>
                <td th:text="${#numbers.formatCurrency(due.amount)}">$1,500</td>
              </tr>
              <tr th:if="${#lists.isEmpty(upcomingDues)}">
                <td colspan="4" class="text-center text-secondary py-4">No hay vencimientos próximos.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h2 class="section-title">Mis Listados Activos</h2>
        <div class="bg-white rounded-xl shadow-sm p-4 overflow-x-auto">
          <div class="flex items-center justify-between mb-4">
            <input type="text" placeholder="Buscar por dirección" class="w-full sm:w-1/3 border border-[#dbe2e6] rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#1193d4]" />
          </div>
          <div class="overflow-x-auto">
            <table>
              <thead>
                <tr class="bg-white">
                  <th>Dirección</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="listing : ${activeListings}" class="border-t border-t-[#e5e7eb]">
                  <td th:text="${listing.address}">123 Maple Street</td>
                  <td>
                    <button
                      class="flex w-24 min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-8 px-4 text-sm font-medium"
                      th:classappend="${listing.status == 'Activo' ? 'status-active' : 'status-paused'}"
                    >
                      <span class="truncate" th:text="${listing.status}">Estado</span>
                    </button>
                  </td>
                  <td class="text-[#1193d4] text-sm font-semibold">
                    <a th:href="@{'/propiedad/' + ${listing.id}}">Ver</a> |
                    <a th:href="@{'/staff/listing/edit/' + ${listing.id}}">Editar</a> |
                    <span th:if="${listing.status == 'Activo'}">Pausar</span>
                    <span th:if="${listing.status == 'Pausado'}">Activar</span> |
                    <a th:href="@{'/staff/listing/delete/' + ${listing.id}}">Eliminar</a>
                  </td>
                </tr>
                <tr th:if="${#lists.isEmpty(activeListings)}">
                  <td colspan="3" class="text-center text-secondary py-4">No tienes listados activos.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div th:replace="footer :: footer"></div>

  </body>
</html>